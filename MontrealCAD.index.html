<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Model Story</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #fff;
        }
        article { max-width: 900px; margin: 0 auto; padding: 48px 24px; }
        header { margin-bottom: 48px; }
        h1 { font-size: 2.5rem; font-weight: bold; color: #111; margin-bottom: 16px; }
        .meta { color: #666; font-size: 0.875rem; }
        h2 { font-size: 1.75rem; font-weight: bold; color: #111; margin-top: 40px; margin-bottom: 16px; }
        p { color: #444; margin-bottom: 24px; font-size: 1.125rem; }
        p.lead { font-size: 1.25rem; color: #555; }
        .model-container { margin: 48px 0; }
        .model-viewer {
            width: 100%; height: 600px; background: #f5f5f5;
            border-radius: 8px; position: relative; overflow: hidden;
            touch-action: none; cursor: grab;
        }
        .model-viewer:active { cursor: grabbing; }
        .model-viewer canvas { display: block; width: 100%; height: 100%; }
        .loading {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); color: #666; font-size: 1rem;
        }
        .caption {
            margin-top: 8px; font-size: 0.875rem; color: #666;
            font-style: italic; text-align: center;
        }
        .instructions { 
            margin-top: 4px; font-size: 0.75rem; color: #999; 
            text-align: center; 
        }
        .scroll-hint {
            position: absolute; bottom: 80px; left: 50%;
            transform: translateX(-50%);
            color: #666; font-size: 0.875rem;
            padding: 8px 16px; background: rgba(255,255,255,0.9);
            border-radius: 20px; pointer-events: none;
            opacity: 0.8; animation: fadeInOut 3s ease-in-out infinite;
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }
        .zoom-controls {
            position: absolute; bottom: 20px; right: 20px;
            display: flex; flex-direction: column; gap: 10px; z-index: 10;
        }
        .zoom-btn {
            width: 44px; height: 44px; background: white;
            border: 2px solid #ddd; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; color: #333; transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .zoom-btn:hover { background: #f8f8f8; border-color: #999; transform: scale(1.05); }
        .zoom-btn:active { transform: scale(0.95); }
        .movement-controls {
            position: absolute; bottom: 20px; right: 80px;
            display: grid; grid-template-columns: repeat(3, 44px);
            grid-template-rows: repeat(3, 44px); gap: 4px; z-index: 10;
        }
        .move-btn {
            width: 44px; height: 44px; background: white;
            border: 2px solid #ddd; border-radius: 8px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.25rem; color: #333; transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .move-btn:hover { background: #f8f8f8; border-color: #999; transform: scale(1.05); }
        .move-btn:active { transform: scale(0.95); }
        .move-up { grid-column: 2; grid-row: 1; }
        .move-left { grid-column: 1; grid-row: 2; }
        .move-right { grid-column: 3; grid-row: 2; }
        .move-down { grid-column: 2; grid-row: 3; }
        .ar-button {
            position: absolute; bottom: 20px; left: 20px;
            background: white; border: 2px solid #ddd;
            border-radius: 8px; padding: 12px 20px;
            font-size: 0.9rem; font-weight: 600;
            color: #333; cursor: pointer;
            display: none; align-items: center; gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s; z-index: 10;
            text-decoration: none;
        }
        .ar-button.visible { display: flex; }
        .ar-button:hover { background: #f8f8f8; border-color: #999; transform: scale(1.05); }
        .ar-button:active { transform: scale(0.95); }
        .ar-icon {
            width: 20px; height: 20px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2"/><path d="M12 2v20M2 12h20"/></svg>') center no-repeat;
            background-size: contain;
        }
    </style>
</head>
<body>
    <article>
        <header>
            <h1>The Story of a Montreal Twenty</h1>
            <div class="meta">
                <span>A Journey Through Canadian Currency</span>
                <span> ‚Ä¢ </span>
                <span>October 15, 2025</span>
            </div>
        </header>

        <p class="lead">
            This isn't just a piece of paper‚Äîit's a $20 Canadian bill with a story to tell. From the streets 
            of Montreal to your screen, this polymer note carries the weight of countless transactions, 
            memories, and the artistry of Canadian design.
        </p>

        <h2>A Bill's Journey Begins</h2>

        <p>
            Somewhere in Montreal, this twenty-dollar bill changed hands for the first time. Perhaps it paid 
            for a steaming bowl of poutine on Saint-Laurent Boulevard, or bought a round of drinks at a jazz 
            club in the Plateau. Each crease and fold tells a story of where it's been and whose hands have held it.
        </p>

        <div class="model-container">
            <div class="model-viewer" id="model1">
                <div class="loading">Loading 3D model...</div>
                <div class="scroll-hint">Drag to rotate ‚Ä¢ WASD to move</div>
                <a href="#" rel="ar" class="ar-button" id="ar-button">
                    <div class="ar-icon"></div>
                    <span>View in AR</span>
                </a>
                <div class="movement-controls">
                    <button class="move-btn move-up" id="move-forward" title="Move Forward (W)">‚Üë</button>
                    <button class="move-btn move-left" id="move-left" title="Move Left (A)">‚Üê</button>
                    <button class="move-btn move-right" id="move-right" title="Move Right (D)">‚Üí</button>
                    <button class="move-btn move-down" id="move-backward" title="Move Backward (S)">‚Üì</button>
                </div>
                <div class="zoom-controls">
                    <button class="zoom-btn" id="zoom-in" title="Zoom In">üîç+</button>
                    <button class="zoom-btn" id="zoom-out" title="Zoom Out">üîç‚àí</button>
                </div>
            </div>
            <p class="caption">The $20 CAD bill from Montreal - Rotate to see both sides</p>
            <p class="instructions">Drag to rotate ‚Ä¢ Scroll or use buttons to zoom ‚Ä¢ Use WASD or arrow buttons to move ‚Ä¢ Tap "View in AR" on iPhone to see in your space</p>
        </div>

        <h2>Portrait of a Queen</h2>

        <p>
            On the front of this bill, Queen Elizabeth II gazes out with the dignified composure that graced 
            Canadian currency for decades. The holographic strip catches light as you turn the bill, a security 
            feature that's also a work of art. The maple leaf window‚Äîtransparent polymer technology unique to 
            Canadian bills‚Äîlets light pass through, a small miracle of modern banking.
        </p>

        <p>
            But this bill is more than its security features. Look closely at the microprinting, the fine lines 
            that spell out "CANADA" in letters so small they're almost invisible to the naked eye. These details 
            aren't just anti-counterfeiting measures‚Äîthey're testament to the craftsmanship that goes into 
            every banknote.
        </p>

        <h2>The Vimy Memorial</h2>

        <p>
            Flip the bill over, and you'll find Canada's tribute to sacrifice and remembrance. The Canadian 
            National Vimy Memorial stands proudly on the reverse, commemorating the Battle of Vimy Ridge. 
            This wasn't just any battle‚Äîit was where Canada came of age as a nation, where four divisions 
            fought together for the first time.
        </p>

        <p>
            The memorial itself rises from the fields of France, two soaring pillars of white stone visible 
            for miles. On this twenty-dollar bill, rendered in shades of green and enhanced with holographic 
            elements, the monument serves as a reminder that currency carries more than monetary value‚Äîit 
            carries memory, identity, and national pride.
        </p>

        <h2>Life in Montreal</h2>

        <p>
            In Montreal, this bill has lived many lives. Maybe it bought a smoked meat sandwich at Schwartz's, 
            the legendary deli that's been serving Montrealers since 1928. Or perhaps it paid for a seat at 
            a Canadiens game, the crowd roaring as the puck hit the net. It might have exchanged hands at 
            Jean-Talon Market, trading for fresh produce and artisanal cheese.
        </p>

        <p>
            The bilingual nature of Montreal itself is reflected in Canadian currency‚Äîevery word appears in 
            both English and French, a constant reminder of the country's dual linguistic heritage. "BANK OF 
            CANADA" shares space with "BANQUE DU CANADA," just as English and French share the streets of 
            Canada's most cosmopolitan city.
        </p>

        <h2>Polymer Revolution</h2>

        <p>
            This isn't paper money‚Äîit's polymer, a technological leap that Canada pioneered. Unlike the cotton-based 
            bills of old, these notes are waterproof, more durable, and nearly impossible to tear. They can survive 
            a trip through the washing machine (though it's not recommended), and they last two to three times longer 
            than paper bills.
        </p>

        <p>
            The switch to polymer wasn't just practical‚Äîit was environmental. These bills are recyclable, and their 
            longer lifespan means fewer bills need to be printed, reducing the overall environmental impact. Innovation 
            and sustainability, printed right into the currency.
        </p>

        <h2>A Twenty's Tale</h2>

        <p>
            Every bill has a serial number, a unique identifier that makes it one of a kind. This particular twenty 
            from Montreal has its own story‚Äîthe caf√©s it's visited, the wallets it's called home, the moments it's 
            been part of. It's been a tip for excellent service, payment for a taxi ride through snowy streets, or 
            maybe just pocket change jingling alongside loonies and toonies.
        </p>

        <p>
            Now it's here, captured in 3D, every detail preserved‚Äîfrom the raised ink you can feel with your fingers 
            to the transparent window that makes Canadian bills instantly recognizable. It's more than money; it's 
            a piece of Canadian identity, a small rectangle of polymer that connects millions of transactions and 
            stories across the nation.
        </p>
    </article>

    <script>
        function init3DViewer(containerId, arButtonId, zoomInId, zoomOutId, moveForwardId, moveBackwardId, moveLeftId, moveRightId, modelUrl, usdzUrl, testingMode) {
            const container = document.getElementById(containerId);
            const loading = container.querySelector('.loading');
            const arButton = document.getElementById(arButtonId);
            const scrollHint = container.querySelector('.scroll-hint');
            
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            
            if ((isIOS || testingMode) && usdzUrl && arButton) {
                arButton.href = usdzUrl;
                arButton.classList.add('visible');
            }
            
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf5f5f5);
            const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 2, 8);
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const dirLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight1.position.set(5, 10, 5);
            scene.add(dirLight1);
            const dirLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            dirLight2.position.set(-5, 5, -5);
            scene.add(dirLight2);
            
            let model = null;
            let targetZ = 8;
            const minZ = 2;
            const maxZ = 15;
            
            const initialRotationDegrees = { x: 0, y: 45, z: 0 };
            const initialRotation = {
                x: initialRotationDegrees.x * (Math.PI / 180),
                y: initialRotationDegrees.y * (Math.PI / 180),
                z: initialRotationDegrees.z * (Math.PI / 180)
            };
            
            let targetRotation = { x: 0, y: 0, z: 0 };
            let isDragging = false;
            let previousMouse = { x: 0, y: 0 };
            let keys = {};
            let buttonMovement = { forward: false, backward: false, left: false, right: false };
            const moveSpeed = 0.1;
            
            document.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
            });
            
            document.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });
            
            const scrollSensitivity = 0.02;
            
            function handleScroll(e) {
                if (!model) return;
                const delta = e.deltaY;
                targetZ -= delta * scrollSensitivity;
                targetZ = Math.max(minZ, Math.min(maxZ, targetZ));
                if (scrollHint) scrollHint.style.display = 'none';
            }
            
            window.addEventListener('wheel', handleScroll, { passive: true });
            
            let touchStartY = 0;
            window.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            window.addEventListener('touchmove', (e) => {
                if (!model) return;
                const touchY = e.touches[0].clientY;
                const delta = touchStartY - touchY;
                targetZ += delta * 0.01;
                targetZ = Math.max(minZ, Math.min(maxZ, targetZ));
                touchStartY = touchY;
                if (scrollHint) scrollHint.style.display = 'none';
            }, { passive: true });
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMouse = { x: e.clientX, y: e.clientY };
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging && model) {
                    const deltaX = e.clientX - previousMouse.x;
                    const deltaY = e.clientY - previousMouse.y;
                    targetRotation.y += deltaX * 0.01;
                    targetRotation.x += deltaY * 0.01;
                    previousMouse = { x: e.clientX, y: e.clientY };
                    if (scrollHint) scrollHint.style.display = 'none';
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            renderer.domElement.addEventListener('mouseleave', () => {
                isDragging = false;
            });
            
            let touchDragStart = { x: 0, y: 0 };
            let isTouchDragging = false;
            
            renderer.domElement.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    isTouchDragging = true;
                    const touch = e.touches[0];
                    touchDragStart = { x: touch.clientX, y: touch.clientY };
                }
            }, { passive: true });
            
            renderer.domElement.addEventListener('touchmove', (e) => {
                if (isTouchDragging && model && e.touches.length === 1) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - touchDragStart.x;
                    const deltaY = touch.clientY - touchDragStart.y;
                    targetRotation.y += deltaX * 0.01;
                    targetRotation.x += deltaY * 0.01;
                    touchDragStart = { x: touch.clientX, y: touch.clientY };
                    if (scrollHint) scrollHint.style.display = 'none';
                }
            }, { passive: false });
            
            renderer.domElement.addEventListener('touchend', () => {
                isTouchDragging = false;
            });
            
            const zoomSpeed = 0.5;
            const zoomInBtn = document.getElementById(zoomInId);
            const zoomOutBtn = document.getElementById(zoomOutId);
            
            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', () => {
                    targetZ -= zoomSpeed;
                    targetZ = Math.max(minZ, Math.min(maxZ, targetZ));
                });
            }
            
            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', () => {
                    targetZ += zoomSpeed;
                    targetZ = Math.max(minZ, Math.min(maxZ, targetZ));
                });
            }
            
            const setupButton = (btn, direction) => {
                if (!btn) return;
                btn.addEventListener('mousedown', () => buttonMovement[direction] = true);
                btn.addEventListener('mouseup', () => buttonMovement[direction] = false);
                btn.addEventListener('mouseleave', () => buttonMovement[direction] = false);
                btn.addEventListener('touchstart', (e) => { e.preventDefault(); buttonMovement[direction] = true; });
                btn.addEventListener('touchend', (e) => { e.preventDefault(); buttonMovement[direction] = false; });
            };
            
            setupButton(document.getElementById(moveForwardId), 'forward');
            setupButton(document.getElementById(moveBackwardId), 'backward');
            setupButton(document.getElementById(moveLeftId), 'left');
            setupButton(document.getElementById(moveRightId), 'right');
            
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
            
            const loader = new THREE.GLTFLoader();
            loader.load(modelUrl, (gltf) => {
                const modelGroup = new THREE.Group();
                const loadedModel = gltf.scene;
                
                const box = new THREE.Box3().setFromObject(loadedModel);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const scale = 2 / maxDim;
                
                loadedModel.position.x = -center.x;
                loadedModel.position.y = -center.y;
                loadedModel.position.z = -center.z;
                loadedModel.scale.multiplyScalar(scale);
                
                modelGroup.add(loadedModel);
                scene.add(modelGroup);
                
                modelGroup.rotation.x = initialRotation.x;
                modelGroup.rotation.y = initialRotation.y;
                modelGroup.rotation.z = initialRotation.z;
                targetRotation.x = initialRotation.x;
                targetRotation.y = initialRotation.y;
                targetRotation.z = initialRotation.z;
                
                model = modelGroup;
                loading.style.display = 'none';
            });
            
            let animationId = null;
            
            function animate() {
                animationId = requestAnimationFrame(animate);
                
                if (model) {
                    if (keys['w']) targetZ -= moveSpeed;
                    if (keys['s']) targetZ += moveSpeed;
                    if (keys['a']) camera.position.x -= moveSpeed;
                    if (keys['d']) camera.position.x += moveSpeed;
                    
                    if (buttonMovement.forward) targetZ -= moveSpeed;
                    if (buttonMovement.backward) targetZ += moveSpeed;
                    if (buttonMovement.left) camera.position.x -= moveSpeed;
                    if (buttonMovement.right) camera.position.x += moveSpeed;
                    
                    camera.position.z += (targetZ - camera.position.z) * 0.1;
                    model.rotation.x += (targetRotation.x - model.rotation.x) * 0.1;
                    model.rotation.y += (targetRotation.y - model.rotation.y) * 0.1;
                    model.rotation.z += (targetRotation.z - model.rotation.z) * 0.1;
                }
                
                camera.lookAt(scene.position);
                renderer.render(scene, camera);
            }
            
            animate();
        }
        
        window.addEventListener('load', () => {
            const TESTING_MODE = true;
            
            init3DViewer(
                'model1', 'ar-button', 'zoom-in', 'zoom-out',
                'move-forward', 'move-backward', 'move-left', 'move-right',
                'https://vlyzifpqemfanxllnmuf.supabase.co/storage/v1/object/public/files/Stephen/3d/10-15-2025_1760560918072.glb',
                'https://vlyzifpqemfanxllnmuf.supabase.co/storage/v1/object/public/files/Stephen/other/10-15-2025-1760560918072_1760561266463.usdz',
                TESTING_MODE
            );
        });
    </script>
</body>
</html>
